```{r setup}
library(rlevante)
library(here)
library(readr)
library(tidyr)
```

```{r}
dataset_spec <- list(
  list(name = "pilot_uniandes_co_bogota:3j4z", version = "current"),
  list(name = "pilot_uniandes_co_rural:66d2",  version = "current"),
  list(name = "pilot_mpieva_de_main:6c0n",     version = "current"),
  list(name = "pilot_western_ca_main:97mt",    version = "current"))

surveys <- get_surveys(dataset_spec)

participants <- get_participants(dataset_spec)
survey_data <- link_surveys(surveys, participants)

survey_data_nested <- survey_data |> nest(data = -survey_type)
write_rds(survey_data_nested, here("01_fetched_data/survey_data_nested.rds"),
          compress = "gz")
```
